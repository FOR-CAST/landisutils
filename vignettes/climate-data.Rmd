---
title: "Preparing Climate Data for Use With LANDIS-II"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Preparing Climate Data for Use With LANDIS-II}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(landisutils)
```

## Define a 'study area' or 'area of interest'

```{r, study-area}
studyAreaBC <- terra::vect(cbind(-122.14, 52.14), crs = "epsg:4326") |>
  terra::project(paste("+proj=lcc +lat_1=49 +lat_2=77 +lat_0=0 +lon_0=-95",
                       "+x_0=0 +y_0=0 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")) |>
  SpaDES.tools::randomStudyArea(seed = 60, size = 1e10) |>
  scfmutils::prepInputsFireRegimePolys(studyArea = _, type = "FRT")
## TODO: subsetType = "intersects"

plot(studyAreaBC["FRT"])
```

## Historical daily weather

### BioSIM

```{r get-biosim-data, eval = FALSE}
climvars <- c(
  ## BioSIM::getModelHelp("ClimaticEx_Daily")
  "Prcp", "SRad", "RelH", "Tair", "Tmax", "Tmin", "WndD", "WndS",
  
  ## BioSIM::getModelHelp("Potential_Evapotranspiration_Daily")
  ## BioSIM::getModelHelp("Potential_Evapotranspiration_Ex_Daily")
  "PET"
)

## TODO: use Prcp / 10 (must be in cm);
## TODO: convert WndS from km/h to m/s;
## TODO: verify wind direction is the FROM Direction;

BioSIM::generateWeather(
  modelNames = c("ClimaticEx_Daily", "Potential_Evapotranspiration_Daily"),
  fromYr = 2018,
  toYr = 2019,
  id = ,      ## TODO: e.g., 1:length(longDeg)
  latDeg = ,  ## TODO: extract points from gridded polygon
  longDeg = , ## TODO: extract points from gridded polygon
  elevM = rep(NA, length(longDeg)),
  rep = 1,
  repModel = 1,
  rcp = "RCP45",      ## shouldn't matter for historical, but FRV to use SSPs not RCPs;
  climModel = "RCM4", ## shouldn't matter for historical, but FRV to use SSPs not RCPs;
  additionalParms = NULL
)
## TODO: gridded values need to be summarized by ecolocation; i.e., `zonal`
```


### Daymet

```{r, get-daymet-data}
climvars <- c("prcp", "tmax", "tmin")

daily_weather <- purrr::map(
  .x = climvars,
  .f = prep_daily_weather,
  studyArea = studyAreaBC,
  id = "FRT", ## TODO: do this for ecoregions too
  start = "2018-01-01",
  end = "2019-12-31"
) |>
  purrr::list_rbind()

head(daily_weather)
```

### Terra Climate Data

```{r, get-terraclim-data}
climvars <- c(
  "aet",
  # "def", "PDSI", "pet",
  "ppt",
  # "q", "soil",
  "srad",
  # "swe",
  "tmax", "tmin",
  # "vap", "vpd",
  "ws"
)

monthly_weather <- purrr::map(
  .x = climvars,
  .f = prep_monthly_weather,
  studyArea = studyAreaBC,
  id = "FRT",
  start = "2018-01-01",
  end = "2019-12-31"
) |>
  purrr::list_rbind()

head(monthly_weather)
```

## Climate projections

See <https://mikejohnson51.github.io/climateR/articles/intro.html#climate-projections>

```{r, get-maca-data}
## TODO
```
